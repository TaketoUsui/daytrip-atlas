# MVP要件定義書

## 1. 概要

### 1.1. 本書の位置づけ

本書は、Webサービス「日帰り地図帳」のMVP（Minimum Viable Product）開発における要件を定義するものです。本書で定義されたスコープと要件に基づき、設計、開発、テストを進めます。

### 1.2. プロジェクトの背景と目的

**背景:** 多くのユーザーは、日帰り旅行先の調査・計画段階で、Web上の情報過多や選択肢の多さから「検索疲れ」や「意思決定の面倒さ」という精神的負担を感じています。

**目的:** 本プロジェクトは、AIによる「ディープ・パーソナライゼーション」を用いて、ユーザー一人ひとりの心に響く「旅の発見」体験を創出することを目的とします。この精神的負担からユーザーを解放し、純粋な「選ぶ」楽しみと「発見」の喜びを提供します。

### 1.3. MVPの目的

本MVP開発は、プロジェクト全体の目的達成に向けた第一歩として、以下の2点を達成することを目的とします。

- **コアバリューの仮説検証:** ユーザーが「出発地を入力するだけで、最適な日帰り旅行プランが複数提案される」というコア体験に価値を感じるかを検証します。
- **データ収集基盤の構築:** 将来のAIパーソナライゼーション精度向上に不可欠な、ユーザーの明示的・暗黙的なフィードバックデータを収集する基盤を構築します。

### 1.4. 用語の定義

| 用語                      | 定義                                                                        |
|-------------------------|---------------------------------------------------------------------------|
| **スポット (Spot)**         | 本サービスが扱う情報の最小単位となる、個別の観光地点（例：〇〇寺、△△カフェ、展望台）。                              |
| **クラスター (Cluster)**     | 複数の`スポット`を地理的・テーマ的にグループ化した観光地域（例：鎌倉エリア、箱根温泉郷）。ユーザーへの提案は、この`クラスター`単位で行われる。 |
| **モデルプラン (Model Plan)** | 特定の`クラスター`内にある複数の`スポット`を、推奨される順序や滞在時間と共に時系列で並べたもの。                        |

## 2. MVPのスコープ

### 2.1. ターゲットユーザー

企画書で定義された、以下の課題を抱えるユーザーを主なターゲットとします。

- **「決めるのが面倒・疲れる」層**
- **「漠然とした欲求」層**
- **「条件の制約」層**

### 2.2. 対象機能 (In Scope)

| ID              | 機能名              | 機能概要                                                                     |
|-----------------|------------------|--------------------------------------------------------------------------|
| **ユーザー向け機能**    |                  |                                                                          |
| `FUNC-001`      | トップページ           | 出発地と簡易的なタグを入力し、旅行提案をリクエストする。                                             |
| `FUNC-002`      | 提案待機ページ          | 提案生成処理の進捗状況をリアルタイムに表示する。                                                 |
| `FUNC-003`      | 提案結果一覧ページ        | 複数の旅行先候補を、キービジュアルやキャッチコピーと共にカード形式で表示する。                                  |
| `FUNC-004`      | 観光地域詳細ページ        | タイムライン形式のモデルプランや各スポットの情報を表示する。                                           |
| `FUNC-005`      | 明示的フィードバック機能     | 各スポットに対し「気になる」「興味なし」の意思表示を行う。                                            |
| **バックエンド/インフラ** |                  |                                                                          |
| `FUNC-006`      | 非同期提案生成処理        | ユーザーを待たせることなく、バックグラウンドで提案生成ジョブを実行する。                                     |
| `FUNC-007`      | 提案ロジック（簡易版）      | 出発地からの距離と選択タグに基づき、DB内のマスターデータから提案を生成する。                                  |
| `FUNC-008`      | ユーザー行動ログ収集       | ユーザーの明示的・暗黙的なフィードバックをDBに記録する。                                            |
| `FUNC-009`      | 【運営者向け】コンテンツ管理機能 | 運営者が、予め用意された管理者アカウントでログインし、Web UI上でスポットやモデルプラン等のマスターデータを管理（CRUD）するための機能。 |

### 2.3. 対象外機能 (Out of Scope)

MVPの目的を達成するため、以下の機能はスコープ外とします。

- **AIによるリアルタイムなコンテンツ生成:** キャッチコピー等は手動で登録したものを表示します。
- **会員登録・ログイン機能:** 全ての機能は匿名ユーザー（セッションベース）に提供されます。
- **提案結果の保存・履歴機能:** 提案結果へは生成された一意のURLでのみアクセス可能です。
- **データに基づくパーソナライゼーション:** 収集したログデータは、MVP段階では提案ロジックに**反映しません**。
- **アフィリエイト連携等の収益化機能**
- **旅行後の評価機能**

---

## 3. 機能要件

### 3.1. ユーザー向け機能

### `FUNC-001`: トップページ

| 項目        | 要件                                                                                                                                                   |
|-----------|------------------------------------------------------------------------------------------------------------------------------------------------------|
| **入力**    | <ol><li>出発地入力フォームを画面中央に配置する。</li><li>Google Places Autocomplete API等を利用し、テキスト入力を補助する。</li><li>5〜10個程度の代表的なタグ（例: 絶景, デート向き）を複数選択できるUIを設置する。</li></ol> |
| **アクション** | <ol><li>「提案を開始する」ボタンを設置する。</li><li>ボタンクリック後、バックエンドにリクエストを送信し、即座に提案待機ページ（`FUNC-002`）へ遷移させる。 </li></ol>                                                |

### `FUNC-002`: 提案待機ページ

| 項目     | 要件                                                                                                                                                                        |
|--------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **表示** | <ol><li>ユーザーごとに一意のURLを生成する。</li><li>バックエンドの処理ステータス（例：候補地の抽出中→パーソナライズ要素を分析中…）と連動した進捗メッセージを表示する。</li></ol                                                                   |
| **動作** | <ol><li>バックエンドの提案生成処理が完了したら、自動的に提案結果一覧ページ（`FUNC-003`）へリダイレクトする。</li><li>バックエンド処理が何らかの理由で失敗した場合、「提案の作成に失敗しました。時間をおいて再度お試しください。」等のエラーメッセージを表示し、トップページへ戻るリンクを提示する。</li></ol> |

### `FUNC-003`: 提案結果一覧ページ

| 項目        | 要件                                                                                                                                                       |
|-----------|----------------------------------------------------------------------------------------------------------------------------------------------------------|
| **表示**    | <ol><li>提案された複数の観光地域（`cluster`）をカード形式で表示する。</li><li>各カードには以下を表示する。<ul><li>キービジュアル画像</li><li>汎用キャッチコピー</li><li>出発地からの移動時間目安</li><li>関連するタグ</ul></li></ol> |
| **アクション** | 1. 各カードは、対応する観光地域詳細ページ（`FUNC-004`）へのリンクとする。                                                                                                              |

### `FUNC-004`: 観光地域詳細ページ

| 項目     | 要件                                                                                                                                |
|--------|-----------------------------------------------------------------------------------------------------------------------------------|
| **表示** | <ol><li>タイムライン形式でモデルプランを表示する。</li><li>プラン内の各ステップ（スポット）について、名称、写真、推奨滞在時間、補足情報などを表示する。</li><li>インタラクティブマップ上にスポットの位置を表示する。</li></ol> |

### `FUNC-005`: 明示的フィードバック機能

| 項目     | 要件                                                                                                                                                   |
|--------|------------------------------------------------------------------------------------------------------------------------------------------------------|
| **UI** | 1. `FUNC-004`の各スポット情報に「❤️ 気になる」「🗑️ 興味なし」ボタンを設置する。                                                                                                   |
| **動作** | <ol><li>ボタンがクリックされた際、セッションIDと対象のスポットID、ステータス（'interested', 'dismissed'）をサーバーに送信し、記録する。</li><li>ユーザーの操作に対し、UI上で即座にフィードバック（例: ボタンの色が変わる）を返す。</li></ol> |

### 3.2. バックエンド/インフラ要件

### `FUNC-006`: 非同期提案生成処理

| 項目        | 要件                                                                                                                                                       |
|-----------|----------------------------------------------------------------------------------------------------------------------------------------------------------|
| **トリガー**  | `FUNC-001`の「提案を開始する」ボタンのクリック。                                                                                                                            |
| **処理フロー** | <ol><li>リクエストを受け付けたら、提案セッション管理テーブルにレコードを作成し、ステータスを「処理中」に設定する。</li><li>提案生成ジョブをキューに投入する。</li><li>ユーザーには、提案セッションの一意なIDを含む待機ページのURLを即時レスポンスとして返す。</li></ol> |

### `FUNC-007`: 提案ロジック（簡易版）

| 項目         | 要件                                                                                                                                                                                       |
|------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **入力**     | 出発地の緯度・経度、選択されたタグIDの配列                                                                                                                                                                   |
| **処理ロジック** | <ol><li>空間データベース関数を使用し、出発地から指定範囲内（例: 150km）にある`クラスター`を抽出する。</li><li>ユーザーが選択したタグに紐づく`スポット`を最も多く含む`クラスター`を優先的に選定する。</li><li>上記条件に合致する`クラスター`から、ランダム性も加えて3〜5件の提案を生成し、結果をDBに保存する。 </li></ol> |

### `FUNC-008`: ユーザー行動ログ収集

| 項目       | 要件                                                                                                                       |
|----------|--------------------------------------------------------------------------------------------------------------------------|
| **収集対象** | <ol><li>提案結果の表示（impression）</li><li>観光地域詳細ページへの遷移（view_cluster_detail）</li><li>明示的フィードバック操作（`FUNC-005`）</li></ol>        |
| **記録**   | <ol><li>上記アクションが発生した際、ユーザー行動ログテーブルにセッションID、アクション種別、対象IDなどを記録する。</li><li>明示的フィードバックは、ユーザーの嗜好データとして別途テーブルに記録する。 </li></ol> |

### 3.3. コンテンツ管理要件

### `FUNC-009`: マスターデータ管理

| 項目        | 要件                                                                            |
|-----------|-------------------------------------------------------------------------------|
| **対象データ** | `spots`, `clusters`, `images`, `categories`, `tags`, `model_plans` 等の各マスターデータ |
| **機能**    | 運営者が、予め用意された管理者アカウントでログインし、Web UI上で上記データをCRUD（作成・読み取り・更新・削除）操作できること。          |

---

## 4. 非機能要件

| 項目          | 要件                                                                                                                                                                               |
|-------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **パフォーマンス** | <ul><li>**Webサーバー応答速度:** ユーザーからのリクエストに対し、待機ページへのリダイレクトレスポンスを500ms以内に返す。</li><li>**バッチ処理時間:** バックグラウンドでの提案生成処理は、90%のケースで90秒以内に完了する。</li></ul>                                     |
| **ユーザビリティ** | ・会員登録を要求せず、トップページアクセスから3クリック以内で最初の提案結果詳細に到達できること。                                                                                                                                |
| **技術スタック**  | <ul><li>**バックエンド:** Laravel</li><li>**フロントエンド:** React (Inertia.js経由)</li><li>**データベース:** PostgreSQL + PostGIS</li></ul>                                                         |
| **初期データ**   | <ul><li>MVPリリース時点で、質の高い旅行提案が可能な最低限のデータとして、**10地域（`clusters`）** 分のモデルプランとそれに紐づくスポットデータが登録済みであること。</li></ul>                                                                       |
| **セキュリティ**  | <ul><li>ユーザーからの入力値（出発地など）は、サーバーサイドで適切にサニタイズ処理を行う。</li><li>XSS（クロスサイトスクリプティング）、CSRF（クロスサイトリクエストフォージェリ）など、フレームワークが提供する基本的な脆弱性対策を有効にする。</li></ul>                                   |
| **制約事項**    | <ul><li>**対応ブラウザ:** Google Chrome, Safari, Microsoft Edgeの最新版。Internet Explorerは対象外とする。</li><li>**対応デバイス:** スマートフォンでの閲覧に最適化されたレスポンシブデザインを前提とする。PCでの閲覧は可能だが、最適化の優先度は低い。</li></ul> |
